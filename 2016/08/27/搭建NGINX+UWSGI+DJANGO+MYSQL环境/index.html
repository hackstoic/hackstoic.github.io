<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="viewpoint from a programmer, think like a life hacker."><title>搭建NGINX+UWSGI+DJANGO+MYSQL环境 | Hackstoic's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">搭建NGINX+UWSGI+DJANGO+MYSQL环境</h1><a id="logo" href="/.">Hackstoic's Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">搭建NGINX+UWSGI+DJANGO+MYSQL环境</h1><div class="post-meta">Aug 27, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><blockquote>
<p>系统环境： ubuntu12.04； python2.7（ ubuntu12.04 默认安装了python2.7版本） </p>
</blockquote>
<h3 id="安装pip工具和python开发环境"><a href="#安装pip工具和python开发环境" class="headerlink" title="安装pip工具和python开发环境"></a>安装pip工具和python开发环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install python-pip python-dev build-essential </div><div class="line">$ sudo pip install --upgrade pip </div><div class="line">$ sudo pip install --upgrade virtualenv </div><div class="line">$ sudo apt-get install libmysqld-dev</div></pre></td></tr></table></figure>
<h3 id="安装django"><a href="#安装django" class="headerlink" title="安装django"></a>安装django</h3><p>sudo pip install django  （下载最新的django）<br>也可以指定django版本进行安装，例如<br>sudo pip install django==1.7.3<br>或者也可以采用源码安装的方式<br>各种系统和各种安装方式的详细说明可以查看这个链接：<br><a href="https://docs.djangoproject.com/en/1.8/intro/install/" target="_blank" rel="external">https://docs.djangoproject.com/en/1.8/intro/install/</a><br>如果你需要移除老的django版本，再进行安装，可以查看：<br><a href="https://docs.djangoproject.com/en/1.8/topics/install/" target="_blank" rel="external">https://docs.djangoproject.com/en/1.8/topics/install/</a></p>
<h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3><p>$ sudo apt-get install mysql-server</p>
<h3 id="安装mysql-python"><a href="#安装mysql-python" class="headerlink" title="安装mysql-python"></a>安装mysql-python</h3><p>$ sudo pip install mysql-python<br>或者使用sudo apt-get install python-mysqldb</p>
<h3 id="安装uwsgi"><a href="#安装uwsgi" class="headerlink" title="安装uwsgi"></a>安装uwsgi</h3><p>sudo pip install uwsgi<br>或者使用源码安装<br>建议不使用apt-get的方式安装uwsgi，<br>用apt-get install安装的uwsgi ，结果nginx无论怎么配置，都会出现502 bad gateway<br>具体原因不明。</p>
<h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><p>sudo apt-get install nginx</p>
<h3 id="测试uwsgi"><a href="#测试uwsgi" class="headerlink" title="测试uwsgi"></a>测试uwsgi</h3><p>新建test文件<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># test.py</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(env, start_response)</span>:</span></div><div class="line">    start_response(<span class="string">'200 OK'</span>, [(<span class="string">'Content-Type'</span>,<span class="string">'text/html'</span>)]) </div><div class="line">   <span class="keyword">return</span><span class="string">"Hello World"</span></div></pre></td></tr></table></figure></p>
<p>然后执行：<br>uwsgi –http :8001 –wsgi-file test.py<br>在浏览器访问 <a href="http://youip:8001" target="_blank" rel="external">http://youip:8001</a> 即可看到结果</p>
<h3 id="建立django项目工程"><a href="#建立django项目工程" class="headerlink" title="建立django项目工程"></a>建立django项目工程</h3><p>假设在/opt/django/目录下建立工程<br>django-admin.py startproject django_test #创建一个Django项目</p>
<h3 id="配置uwsgi"><a href="#配置uwsgi" class="headerlink" title="配置uwsgi"></a>配置uwsgi</h3><p>（vim /opt/django/django_test/uwsgi_setting.ini, 粘贴以下内容）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[uwsgi]</div><div class="line"><span class="built_in">chdir</span>=/opt/django/django_<span class="built_in">test</span>/</div><div class="line">module=django_test.wsgi</div><div class="line">master=True</div><div class="line">pidfile=/tmp/net.pid</div><div class="line">vacuum=True</div><div class="line">max-requests=5000</div><div class="line">daemonize=/var/<span class="built_in">log</span>/uwsgi.log</div><div class="line">processes=10</div><div class="line">socket=127.0.0.1: 8001</div></pre></td></tr></table></figure>
<p>启动uwsgi –&gt;  uwsgi  –ini  /opt/django/django_test/uwsgi_setting.ini</p>
<h3 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h3><p>（在/etc/nginx/sites-available下建文件django_test.conf，内容如下，并且在 /etc/nginx/sites-enabled下建该文件的软链接ln -s ../sites-available/django_test.conf django_test.conf）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">server &#123;   </div><div class="line"><span class="comment"># 侦听的端口</span></div><div class="line">listen       80; </div><div class="line"><span class="comment"># 绑定的ip地址或者域名 </span></div><div class="line">server_name  127.0.0.1;</div><div class="line">access_<span class="built_in">log</span>  /var/<span class="built_in">log</span>/django_<span class="built_in">test</span>_nginx.log;</div><div class="line">location / &#123; </div><div class="line">send_timeout 120; </div><div class="line"><span class="comment"># 这里的端口要和uswgi配置的一致 </span></div><div class="line">uwsgi_pass 127.0.0.1: 8001;</div><div class="line">include /etc/nginx/uwsgi_params;</div><div class="line">&#125;</div><div class="line">location /static/admin/&#123; </div><div class="line"><span class="comment">#  django模块路径可能会有差异，请根据实际情况调整 </span></div><div class="line"><span class="built_in">alias</span> /usr/<span class="built_in">local</span>/lib/python2.7/dist-packages/Django-1.7.1-py2.7.egg/django/contrib/admin/static/admin/;</div><div class="line">access_<span class="built_in">log</span> off;</div><div class="line">&#125;</div><div class="line"></div><div class="line">location /static&#123;</div><div class="line">    <span class="built_in">alias</span> /opt/django/django_<span class="built_in">test</span>/static/;</div><div class="line">    access_<span class="built_in">log</span> off;</div><div class="line">&#125; </div><div class="line"></div><div class="line">location /file/&#123;</div><div class="line"><span class="built_in">alias</span> /var/www/file/;</div><div class="line">access_<span class="built_in">log</span> off;</div><div class="line">&#125;</div><div class="line"></div><div class="line">location /webalizer/ &#123;</div><div class="line"><span class="built_in">alias</span> /var/www/webalizer/;</div><div class="line">access_<span class="built_in">log</span> off;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>启动nginx –&gt; nginx -c  /etc/nginx/nginx.conf<br>配置重载（修改配置后要进行此操作） –&gt; nginx  -s reload</p>
<p>就此django + mysql  + uwsgi + nginx的配置就完成了。你可以打开127.0.0.1访问你的网站了。 </p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/08/27/搭建NGINX+UWSGI+DJANGO+MYSQL环境/" data-id="cisy6ohlw000ln13hpz8p5l8i" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2016/08/27/开源web堡垒机GateOne初探（1）/" class="pre">开源web堡垒机GateOne初探（1）</a><a href="/2016/08/27/个人博客建设之路/" class="next">个人网站建设之路</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/11/浅谈日志分析系统ELK/">浅谈日志分析系统ELK</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/10/内网穿透/">内网穿透</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/kubernetes初探/">kubernetes初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/28/0gopher meetup 深圳站2016-08-28/">gopher meetup 深圳站2016-08-28</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/27/开源web堡垒机GateOne初探（2）/">开源web堡垒机GateOne初探（2）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/27/开源web堡垒机GateOne初探（1）/">开源web堡垒机GateOne初探（1）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/27/搭建NGINX+UWSGI+DJANGO+MYSQL环境/">搭建NGINX+UWSGI+DJANGO+MYSQL环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/27/个人博客建设之路/">个人网站建设之路</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/27/数据分析遐想/">数据分析遐想</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/27/浅谈日志分析系统ELK/">ELK不权威指南</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://coolshell.cn/" title="酷壳" target="_blank">酷壳</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Hackstoic's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>